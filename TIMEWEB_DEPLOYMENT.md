# Деплой Telegram-бота на Timeweb Cloud Apps

## Подготовка к деплою

### Необходимые переменные окружения

1. `BOT_TOKEN`: Токен вашего Telegram-бота от @BotFather
   - **ВАЖНО**: Никогда не публикуйте токен в открытом доступе!
   - Используйте секретные переменные в настройках Timeweb Cloud Apps
   - Токен: `7875071911:AAFUbiivWfJr2E2Zhge4GCFWx5AacKzysmM`

2. `WEBHOOK_HOST`: Домен вашего приложения
   - Текущий домен: `txmerlxn-telegram-bot-v5-17ee.twc1.net`

3. `WEBHOOK_PORT`: Порт для webhook (по умолчанию 8080)

4. `USE_WEBHOOK`: Режим webhook (true/false)

### Безопасность токена

⚠️ **ПРЕДУПРЕЖДЕНИЕ**:
- Немедленно измените токен, если он был случайно опубликован
- Никогда не коммитьте токен в репозиторий
- Используйте переменные окружения для хранения чувствительных данных

### Деплой на Timeweb Cloud Apps

#### Подключение репозитория в Timeweb Cloud Apps

### Варианты подключения

1. **Через GitHub**: 
   - Репозиторий: `TXMERLXN/TELEGRAM_BOT_V5`
   - Ветка: `master`

2. **По прямой ссылке**:
   ```
   https://github.com/TXMERLXN/TELEGRAM_BOT_V5.git
   ```

### Процесс подключения

1. Перейдите в раздел «Apps» в Timeweb Cloud
2. Нажмите «Создать»
3. Выберите способ подключения репозитория
   - Для GitHub: выберите иконку GitHub
   - Для прямой ссылки: выберите «Подключить git-репозиторий по URL»
4. Авторизуйтесь или введите URL репозитория
5. Выберите ветку `master`

> **Важно:** Автодеплой будет работать только при подключении через GitHub, GitLab или BitBucket

#### Подготовка к деплою

1. **Репозиторий**: Код размещен на GitHub
2. **Dockerfile**: Находится в корне репозитория
3. **Порт**: Приложение будет доступно на порту 8080

#### Настройка переменных окружения

В панели управления Timeweb Cloud Apps необходимо установить следующие переменные:
- `BOT_TOKEN`: Токен Telegram-бота
- `WEBHOOK_HOST`: Домен приложения
- `WEBHOOK_PORT`: 8080
- `USE_WEBHOOK`: true

#### Шаги деплоя

1. Перейти в раздел Timeweb Cloud Apps
2. Выбрать тип приложения: **Dockerfile**
3. Подключить репозиторий: `TXMERLXN/TELEGRAM_BOT_V5`
4. Выбрать ветку: `master`
5. Настроить переменные окружения
6. Запустить деплой

#### Мониторинг

- Отслеживать процесс деплоя в логах
- Проверить доступность бота после деплоя

#### Автоматическое обновление

Включите опцию автоматического деплоя для пересборки при каждом новом коммите в ветке `master`.

### Настройка Webhook для Telegram Bot

1. Полный URL webhook:
   ```
   https://txmerlxn-telegram-bot-v5-17ee.twc1.net/webhook
   ```

2. В настройках бота через @BotFather укажите этот webhook URL

### Проверка webhook

Для проверки webhook можно использовать команды:
```bash
# Установка webhook
curl -F "url=https://txmerlxn-telegram-bot-v5-17ee.twc1.net/webhook" \
     https://api.telegram.org/bot<ВАШ_ТОКЕН>/setWebhook

# Проверка текущего webhook
curl https://api.telegram.org/bot<ВАШ_ТОКЕН>/getWebhookInfo
```

## Управление приложением в Timeweb Cloud Apps

### Автодеплой

- Включите опцию «Сборка по последнему выполненному коммиту»
- Сервис будет автоматически обновлять приложение при новых коммитах

> **Важно:** Автодеплой работает только для репозиториев, подключенных через GitHub, GitLab или BitBucket

### Мониторинг ресурсов

1. Перейдите в раздел **Apps**
2. Выберите приложение
3. Откройте вкладку **Дашборд**

Отслеживайте использование:
- Процессор
- Память
- Интернет-канал
- Дисковое пространство

### Технический домен

При деплое вам будет предоставлен бесплатный домен:
```
https://txmerlxn-telegram-bot-v5-17ee.twc1.net
```

### Привязка собственного домена

1. Перейдите в раздел **Домены**
2. Выберите домен или добавьте новый
3. Создайте A-запись, привязав к приложению
4. Настройте NS-серверы (если домен от другого провайдера)

### Возможные действия

- Остановить деплой
- Перезапустить приложение
- Изменить параметры деплоя
- Выбрать другую конфигурацию сервера

> **Совет:** Регулярно проверяйте использование ресурсов и при необходимости масштабируйте приложение

## Возможные проблемы и решения

### Webhook не работает
- Проверьте корректность `BOT_TOKEN`
- Убедитесь, что порты открыты
- Проверьте логи приложения

### Ошибки при сборке Docker-образа
- Убедитесь, что все зависимости указаны в `requirements.txt`
- Проверьте, что `.dockerignore` настроен корректно

## Мониторинг и логирование

Используйте встроенные инструменты Timeweb Cloud для просмотра логов и состояния приложения.

## Обновление бота

При каждом обновлении:
1. Обновите код в репозитории
2. Пересоберите Docker-образ
3. Перезапустите приложение в Timeweb Cloud

---

*Последнее обновление: 17.01.2025*
